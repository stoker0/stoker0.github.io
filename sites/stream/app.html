<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>benpstokerbeats Streaming</title>
  <link rel="icon" href="/sites/stream/assets/favicon.ico" type="image/x-icon">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter+Tight:wght@400;700&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
    :root {
      --bg-color: #f0f0f5;
      --text-color: #333;
      --album-bg: rgba(240, 240, 245, 0.7);
      --box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      --footer-color: #777;
      --modal-bg: #ffffff;
      --input-bg: #f9f9f9;
      --input-text: #333;
      --button-bg: #4CAF50;
      --button-text: #fff;
      --select-bg: #f0f0f5;
      --select-text: #333;
      --progress-bg: #ddd;
      --progress-fill: #4CAF50;
      --play-button-bg: #4CAF50;
      --play-button-hover-bg: #45a049;
      --glass-bg: rgba(240, 240, 245, 0.85);
      --glass-border: rgba(255, 255, 255, 0.5);
    }

    [data-theme='dark'] {
      --bg-color: #121212;
      --text-color: #f0f0f5;
      --album-bg: rgba(40, 40, 40, 0.7);
      --box-shadow: 0 2px 8px rgba(0,0,0,0.5);
      --footer-color: #aaa;
      --modal-bg: #1e1e1e;
      --input-bg: #2a2a2a;
      --input-text: #f0f0f5;
      --button-bg: #388e3c;
      --button-text: #fff;
      --select-bg: #2a2a2a;
      --select-text: #f0f0f5;
      --progress-bg: #444;
      --progress-fill: #388e3c;
      --play-button-bg: #388e3c;
      --play-button-hover-bg: #2e7d32;
      --glass-bg: rgba(40, 40, 40, 0.85);
      --glass-border: rgba(255, 255, 255, 0.1);
    }

    [data-theme='ocean'] {
      --bg-color: linear-gradient(135deg, #1a2a6c 0%, #2a4c7c 50%, #2c5c8f 100%);
      --text-color: #ffffff;
      --album-bg: rgba(42, 76, 124, 0.4);
      --box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      --footer-color: #b0c4de;
      --modal-bg: rgba(42, 76, 124, 0.95);
      --input-bg: rgba(255, 255, 255, 0.1);
      --input-text: #ffffff;
      --button-bg: #4a90e2;
      --button-text: #fff;
      --select-bg: rgba(255, 255, 255, 0.1);
      --select-text: #ffffff;
      --progress-bg: rgba(255, 255, 255, 0.2);
      --progress-fill: #4a90e2;
      --play-button-bg: #4a90e2;
      --play-button-hover-bg: #357abd;
      --accent-color: #4a90e2;
      --accent-hover: #357abd;
      --now-playing-bg: rgba(20, 20, 20, 0.75);
      --now-playing-text: #ffffff;
      --now-playing-shadow: 0 -2px 10px rgba(0,0,0,0.3);
      --glass-bg: rgba(42, 76, 124, 0.6);
      --glass-border: rgba(255, 255, 255, 0.15);
      --time-color: #ffffff;
    }

    [data-theme='sunset'] {
      --bg-color: linear-gradient(135deg, #8B0000, #D35400, #CC4400);
      --text-color: #ffffff;
      --album-bg: rgba(255, 255, 255, 0.1);
      --box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      --footer-color: #ffa07a;
      --modal-bg: rgba(139, 0, 0, 0.95);
      --input-bg: rgba(255, 255, 255, 0.1);
      --input-text: #ffffff;
      --button-bg: #ff7043;
      --button-text: #fff;
      --select-bg: rgba(255, 255, 255, 0.1);
      --select-text: #ffffff;
      --progress-bg: rgba(255, 255, 255, 0.2);
      --progress-fill: #ff7043;
      --play-button-bg: #ff7043;
      --play-button-hover-bg: #f4511e;
      --accent-color: #ff7043;
      --accent-hover: #f4511e;
      --now-playing-bg: rgba(20, 20, 20, 0.75);
      --now-playing-text: #ffffff;
      --now-playing-shadow: 0 -2px 10px rgba(0,0,0,0.3);
      --glass-bg: rgba(255, 255, 255, 0.1);
      --glass-border: rgba(255, 255, 255, 0.15);
      --time-color: #ffffff;
    }

    [data-theme='emerald'] {
      --bg-color: linear-gradient(135deg, #1a5f3c, #2d8659, #134b2b);
      --text-color: #ffffff;
      --album-bg: rgba(255, 255, 255, 0.1);
      --box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      --footer-color: #a7e9c3;
      --modal-bg: rgba(39, 174, 96, 0.95);
      --input-bg: rgba(255, 255, 255, 0.1);
      --input-text: #ffffff;
      --button-bg: #2ecc71;
      --button-text: #fff;
      --select-bg: rgba(255, 255, 255, 0.1);
      --select-text: #ffffff;
      --progress-bg: rgba(255, 255, 255, 0.2);
      --progress-fill: #2ecc71;
      --play-button-bg: #2ecc71;
      --play-button-hover-bg: #27ae60;
      --accent-color: #2ecc71;
      --accent-hover: #27ae60;
      --now-playing-bg: rgba(20, 20, 20, 0.75);
      --now-playing-text: #ffffff;
      --now-playing-shadow: 0 -2px 10px rgba(0,0,0,0.3);
      --glass-bg: rgba(255, 255, 255, 0.1);
      --glass-border: rgba(255, 255, 255, 0.15);
      --time-color: #ffffff;
    }

    body {
      display: flex;
      min-height: 100vh;
      margin: 0;
      background: var(--bg-color);
      background-attachment: fixed;
      color: var(--text-color);
      font-family: 'Inter Tight', 'Inter', sans-serif;
    }
    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      width: 300px;
      background: var(--glass-bg);
      box-shadow: var(--box-shadow);
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-right: 1px solid var(--glass-border);
      z-index: 10;
    }
    .sidebar > div:first-of-type {
      margin-top: 0;
    }
    .sidebar > div {
      width: 100%;
    }
    .main-content {
      margin-left: 340px;
      flex: 1;
      padding: 30px;
      padding-bottom: 80px;
      overflow-y: auto;
      box-sizing: border-box;
    }
    .album {
      background: var(--album-bg);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 30px;
      box-shadow: var(--box-shadow);
      text-align: center;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .album:hover {
      transform: translateY(-5px);
      box-shadow: var(--box-shadow), 0 10px 20px rgba(0,0,0,0.1);
    }
    header {
      margin-bottom: 30px;
    }
    footer {
      margin-top: 50px;
      text-align: center;
      color: var(--footer-color);
    }
    .theme-select {
      margin-top: 20px;
    }

    select {
      appearance: none;
      background: var(--select-bg);
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      width: 100%;
      font-family: 'Inter Tight', 'Inter', sans-serif;
      color: var(--select-text);
    }
    #login-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 1000;
      background: var(--bg-color);
      gap: 0;
    }
    #login-modal > div {
      flex: 1;
      padding: 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
    }
    #login-modal .welcome-section {
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-right: 1px solid var(--glass-border);
      flex: 0 0 55%;
      text-align: center;
      padding: 0 30px;
    }
    #login-modal .welcome-section h1 {
      font-size: 3em;
      margin-bottom: 20px;
      color: var(--text-color);
      max-width: 800px;
      width: 100%;
    }
    #login-modal .welcome-section p {
      font-size: 1.2em;
      color: var(--text-color);
      text-align: center;
      max-width: 600px;
      width: 100%;
    }
    #login-modal .form-section {
      flex: 0 0 35%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 0 30px;
      width: 100%;
    }
    #login-modal .form-section > * {
      width: 100%;
      max-width: min(350px, 90%);
    }
    #login-modal .form-section h2 {
      text-align: center;
      margin-bottom: 20px;
      font-size: clamp(1.5em, 3vw, 2em);
    }
    #login-modal .form-section input,
    #login-modal .form-section button {
      width: 100%;
      padding: clamp(8px, 2vw, 12px);
      font-size: clamp(14px, 2vw, 16px);
    }
    #login-modal .form-section p {
      text-align: center;
      margin-top: 20px;
      font-size: clamp(14px, 2vw, 16px);
    }
    #login-modal input {
      background: var(--input-bg);
      color: var(--input-text);
      border: 1px solid #ccc;
    }
    #login-modal button {
      background: var(--button-bg);
      color: var(--button-text);
    }
    #login-modal button:hover {
      background: var(--accent-hover);
    }
    audio::-webkit-media-controls-panel {
      background-color: var(--album-bg);
      color: var(--text-color);
    }
    audio {
      border-radius: 10px;
      overflow: hidden;
    }
    .lossless {
      font-size: 0.85em;
      color: #28a745;
      font-weight: bold;
    }
    .track-row {
      background: var(--glass-bg);
      border-radius: 10px;
      padding: 8px 15px;
      margin-bottom: 8px;
      box-shadow: var(--box-shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .track-info {
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 1;
      min-width: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .track-info span {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    audio {
      width: 100%;
      margin-top: 5px;
    }
    .album-cover {
      width: 70%;
      max-width: 300px;
      border-radius: 15px;
      margin-bottom: 20px;
      display: block;
      margin-left: auto;
      margin-right: auto;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    .album-option .album-cover {
      cursor: pointer;
      transition: transform 0.3s ease;
    }
    .album-option .album-cover:hover {
      transform: scale(1.02);
    }
    .track-row button {
      margin-left: 15px;
      font-size: 24px;
      width: 36px;
      height: 36px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .now-playing {
      position: fixed;
      bottom: 0;
      left: 340px;
      right: 0;
      background: var(--now-playing-bg);
      box-shadow: var(--now-playing-shadow);
      padding: 12px 15px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-family: 'Inter Tight', 'Inter', sans-serif;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-top: 1px solid var(--glass-border);
      min-height: 65px;
      box-sizing: border-box;
    }
    .now-playing .track-name {
      width: clamp(50px, 15vw, 120px);
      min-width: clamp(50px, 15vw, 120px);
      max-width: clamp(50px, 15vw, 120px);
      overflow: hidden;
      font-size: 0.9em;
      color: var(--text-color);
    }
    .track-name-text {
      white-space: nowrap;
      display: inline-block;
      animation: scrollText 12s linear infinite;
    }
    .now-playing-controls {
      display: flex;
      align-items: center;
      gap: 8px;
      flex: 1;
    }
    .progress-container {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.8em;
      user-select: none;
      min-width: 0;
    }
    .progress-bar {
      flex: 1;
      height: 4px;
      background: var(--progress-bg);
      border-radius: 2px;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      min-width: 0;
    }
    #audio-volume {
      width: 70px;
      accent-color: var(--accent-color);
    }
    .album-selection {
      display: flex;
      justify-content: space-around;
      margin-top: 50px;
      flex-wrap: wrap;
      gap: 30px;
    }
    .album-option {
      text-align: center;
      cursor: pointer;
      max-width: 300px;
      flex: 1;
      min-width: 250px;
    }
    .album-option img {
      width: 250px;
      height: 250px;
      object-fit: cover;
      border-radius: 10px;
      transition: transform 0.3s;
    }
    .album-option:hover img {
      transform: scale(1.05);
    }
    .album-view {
      text-align: center;
      padding-left: 0;
      max-width: 800px;
      margin: 0 auto;
    }
    .album-view .track {
      margin-top: 15px;
    }
    button {
      background: var(--button-bg);
      color: var(--button-text);
      border: none;
      padding: 10px 15px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.2s ease;
    }
    button:hover {
      background: var(--accent-hover, var(--button-hover-bg, #45a049));
    }
    .disabled-btn {
      background: #888 !important;
      cursor: not-allowed;
      opacity: 0.6;
    }
    button.back {
      background: var(--accent-color);
      color: var(--button-text);
      font-size: 0.9em;
      margin-bottom: 20px;
    }
    button.back:hover {
      background: var(--accent-hover);
    }
    .play-pause-btn {
      background: var(--play-button-bg);
      border: none;
      color: var(--button-text);
      font-size: 24px;
      width: 38px;
      height: 38px;
      padding: 0;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s ease;
      user-select: none;
    }
    .play-pause-btn:hover {
      background: var(--play-button-hover-bg);
    }
    .time-current, .time-duration {
      color: var(--time-color);
    }
    .now-playing label {
      color: var(--text-color);
    }
    .settings-view {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    .settings-section {
      background: var(--glass-bg);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: var(--box-shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
    }
    .settings-section h3 {
      margin-top: 0;
      margin-bottom: 15px;
      color: var(--text-color);
    }
    .theme-select-settings select,
    .language-select-settings select {
      width: 200px;
      margin-left: 10px;
    }
    .theme-select-settings,
    .language-select-settings {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .settings-view h2 {
      text-align: center;
      width: 100%;
      margin: 0 0 30px 0;
      font-size: 1.5em;
      padding: 0;
    }
    @media (max-width: 768px) {
      .sidebar {
        position: fixed;
        left: -100%;
        width: 100%;
        height: 100%;
        transition: left 0.3s ease;
        z-index: 1000;
        display: none;
        padding: 20px;
        box-sizing: border-box;
      }
      
      .sidebar > div {
        width: 100%;
        max-width: 100%;
      }
      
      .sidebar.active {
        display: block;
        left: 0;
      }
      .sidebar h1 {
        font-size: 1.5em;
        margin-bottom: 20px;
        text-align: center;
      }
      .sidebar button {
        width: 100%;
        margin-top: 15px;
      }
      .main-content {
        margin-left: 0;
        width: 100%;
        padding: 20px;
        padding-top: 80px;
        padding-bottom: 80px;
      }
      .main-content h1 {
        font-size: 1.5em;
        margin-bottom: 20px;
        text-align: center;
        width: 100%;
      }
      .album-selection {
        flex-direction: column;
        align-items: center;
        gap: 30px;
      }
      .album-option {
        width: 100%;
        max-width: 300px;
      }
      .now-playing {
        left: 0;
        width: 100%;
        padding: 12px 15px;
        min-height: 65px;
      }
      .now-playing .track-name {
        width: clamp(50px, 15vw, 120px);
        min-width: clamp(50px, 15vw, 120px);
        max-width: clamp(50px, 15vw, 120px);
      }
      .hamburger-menu {
        display: flex !important;
      }
      .close-menu {
        display: flex !important;
      }
      #login-modal {
        flex-direction: column;
        padding: 20px;
        box-sizing: border-box;
      }
      #login-modal .welcome-section {
        display: none;
      }
      #login-modal .form-section {
        flex: 1;
        width: 100%;
        max-width: 100%;
        padding: 20px;
        justify-content: center;
        background: var(--glass-bg);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-radius: 15px;
        box-sizing: border-box;
      }
      #login-modal .form-section > * {
        max-width: 100%;
        width: 100%;
        box-sizing: border-box;
      }
      #login-modal .form-section h2 {
        font-size: 1.5em;
        margin-bottom: 20px;
        text-align: center;
        padding: 0 10px;
      }
      #login-modal input,
      #login-modal button {
        width: 100%;
        box-sizing: border-box;
        margin-left: 0;
        margin-right: 0;
      }
      #mobile-welcome, .settings-view h2 {
        margin: 0 0 30px 0;
      }
      .settings-view {
        padding-top: 0;
      }
      .play-pause-btn {
        width: 42px;
        height: 42px;
        font-size: 26px;
      }
      .progress-container {
        gap: 8px;
        font-size: 0.85em;
      }
      .progress-bar {
        height: 5px;
      }
      #audio-volume {
        width: 80px;
      }
    }

    .hamburger-menu {
      display: none;
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 100;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 8px;
      padding: 6px;
      cursor: pointer;
      font-size: 20px;
      width: 32px;
      height: 32px;
      align-items: center;
      justify-content: center;
      color: var(--text-color);
      box-shadow: var(--box-shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .close-menu {
      display: none;
      position: absolute;
      right: 20px;
      font-size: 24px;
      cursor: pointer;
      color: var(--text-color);
      width: 40px;
      height: 40px;
      align-items: center;
      justify-content: center;
      background: none;
      border: none;
      padding: 0;
    }
    .menu-header {
      position: relative;
      width: 100%;
      height: 20px;
    }
    .progress-fill {
      height: 100%;
      background: var(--progress-fill);
      border-radius: 2px;
      width: 0%;
      transition: width 0.1s linear;
    }
    @keyframes scrollText {
      0% {
          transform: translateX(0%);
      }
      45% {
          transform: translateX(0%);
      }
      50% {
          transform: translateX(calc(-100% + clamp(50px, 15vw, 120px)));
      }
      95% {
          transform: translateX(calc(-100% + clamp(50px, 15vw, 120px)));
      }
      100% {
          transform: translateX(0%);
      }
    }

    /* Remove the hover-based animation trigger */
    .now-playing .track-name:hover .track-name-text {
        animation-play-state: running;
    }

    /* Clean up theme variables - remove duplicates */
    [data-theme='ocean'],
    [data-theme='sunset'],
    [data-theme='emerald'] {
      --now-playing-bg: rgba(20, 20, 20, 0.75);
      --now-playing-text: #ffffff;
      --now-playing-shadow: 0 -2px 10px rgba(0,0,0,0.3);
    }

    .sidebar button {
      background: var(--glass-bg);
      color: var(--text-color);
      border: 1px solid var(--glass-border);
      padding: 12px 15px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.2s ease;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: var(--box-shadow);
    }

    .sidebar button:hover {
      background: var(--glass-bg);
      transform: translateY(-2px);
      box-shadow: var(--box-shadow), 0 4px 8px rgba(0,0,0,0.1);
    }

    .sidebar button:active {
      transform: translateY(0);
      box-shadow: var(--box-shadow);
    }

    @media (max-width: 768px) {
      .sidebar button {
        width: 100%;
        margin-top: 15px;
        padding: 14px 15px;
      }
    }
  </style>
</head>
<script>
  function setTheme(theme) {
    if (theme === 'system') {
      document.documentElement.setAttribute('data-theme', 
        window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
      );
    } else {
      document.documentElement.setAttribute('data-theme', theme);
    }
    localStorage.setItem('bpsb-theme', theme);
    
    // Save theme to user account if logged in
    const currentUser = localStorage.getItem('bpsb-current');
    if (currentUser) {
      let users = JSON.parse(localStorage.getItem('bpsb-users')) || {};
      if (users[currentUser]) {
        users[currentUser].theme = theme;
        localStorage.setItem('bpsb-users', JSON.stringify(users));
      }
    }
  }

  function setLanguage(lang) {
    localStorage.setItem('bpsb-language', lang);
  }

  function getGreeting() {
    const hour = new Date().getHours();
    if (hour >= 5 && hour < 12) return "Good morning";
    if (hour >= 12 && hour < 17) return "Good afternoon";
    return "Good evening";
  }

  function updateAllWelcomeText(user) {
    const greeting = user ? `${getGreeting()}, ${user}` : 'benpstokerbeats Streaming';
    const sidebarWelcome = document.getElementById('sidebar-welcome');
    const mobileWelcome = document.getElementById('mobile-welcome');
    
    if (window.innerWidth <= 768) {
      sidebarWelcome.textContent = 'Menu';
      if (mobileWelcome) {
        mobileWelcome.textContent = greeting;
      }
    } else {
      sidebarWelcome.textContent = greeting;
      if (mobileWelcome) {
        mobileWelcome.style.display = 'none';
      }
    }
  }

  function submitForm() {
    const user = document.getElementById('login-username').value.trim();
    const pass = document.getElementById('login-password').value;
    const email = document.getElementById('login-email')?.value.trim() || '';
    
    if (!user || !pass || (isSignup && !email)) {
      alert('Please fill all fields.');
      return;
    }

    let users = JSON.parse(localStorage.getItem('bpsb-users')) || {};
    
    if (isSignup) {
      if (users[user]) {
        alert('Username already exists.');
        return;
      }
      users[user] = { password: pass, email, theme: 'system' };
    } else {
      if (!users[user] || users[user].password !== pass) {
        alert(users[user] ? 'Incorrect password.' : 'Username not found.');
        return;
      }
    }

    localStorage.setItem('bpsb-users', JSON.stringify(users));
    localStorage.setItem('bpsb-current', user);
    document.getElementById('login-modal').style.display = 'none';
    updateAllWelcomeText(user);
    setTheme(users[user].theme || 'system');
  }

  function logout() {
    localStorage.removeItem('bpsb-current');
    isSignup = false;
    document.getElementById('login-modal').style.display = 'flex';
    updateAllWelcomeText(null);
    if (window.innerWidth <= 768) {
      toggleSidebar();
    }
  }

  function formatTime(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins}:${secs.toString().padStart(2,'0')}`;
  }

  function playNow(name, src) {
    const nowPlaying = document.getElementById('now-playing');
    const trackName = document.getElementById('current-track');
    const audio = document.getElementById('now-playing-audio');
    const playPauseBtn = document.getElementById('play-pause-btn');
    const progressBar = document.getElementById('progress-bar');
    const progressFill = document.getElementById('progress-fill');
    const timeCurrent = document.getElementById('time-current');
    const timeDuration = document.getElementById('time-duration');

    const newAudio = audio.cloneNode(true);
    audio.parentNode.replaceChild(newAudio, audio);

    trackName.innerHTML = `<span class="track-name-text" style="animation: none;">${name}</span>`;
    
    const textSpan = trackName.querySelector('.track-name-text');
    void textSpan.offsetWidth; // Force reflow
    
    textSpan.style.animation = textSpan.scrollWidth > trackName.offsetWidth 
      ? 'scrollText 12s linear infinite' 
      : 'none';

    newAudio.src = src;
    newAudio.play();
    nowPlaying.style.display = 'flex';
    
    if (playPauseBtn) {
      playPauseBtn.disabled = false;
      playPauseBtn.classList.remove('disabled-btn');
      playPauseBtn.innerHTML = '&#x23f8;';
      playPauseBtn.setAttribute('aria-label', 'Pause');
    }

    progressFill.style.width = '0%';
    timeCurrent.textContent = '0:00';
    timeDuration.textContent = '--:--';

    setupAudioEventListeners(newAudio, playPauseBtn, progressBar, progressFill, timeCurrent, timeDuration);
  }

  function setupAudioEventListeners(audio, playPauseBtn, progressBar, progressFill, timeCurrent, timeDuration) {
    const vol = document.getElementById('audio-volume');

    // Volume control
    if (vol) {
      audio.volume = vol.value;
      vol.oninput = () => {
        audio.volume = vol.value;
      };
    }

    // Play/Pause button
    if (playPauseBtn) {
      playPauseBtn.onclick = () => {
        if (audio.paused) {
          audio.play();
          playPauseBtn.innerHTML = '&#x23f8;';
          playPauseBtn.setAttribute('aria-label', 'Pause');
        } else {
          audio.pause();
          playPauseBtn.innerHTML = '&#x23f5;';
          playPauseBtn.setAttribute('aria-label', 'Play');
        }
      };
    }

    // Time update for progress bar
    audio.ontimeupdate = () => {
      if (audio.duration) {
        const percent = (audio.currentTime / audio.duration) * 100;
        progressFill.style.width = percent + '%';
        timeCurrent.textContent = formatTime(audio.currentTime);
        timeDuration.textContent = formatTime(audio.duration);
        progressBar.setAttribute('aria-valuenow', Math.floor(percent));
      }
    };

    // Progress bar click
    progressBar.onclick = (e) => {
      if (!audio.duration) return;
      const rect = progressBar.getBoundingClientRect();
      const pos = (e.clientX - rect.left) / rect.width;
      audio.currentTime = pos * audio.duration;
    };

    // Progress bar touch
    progressBar.ontouchstart = (e) => {
      if (!audio.duration) return;
      const rect = progressBar.getBoundingClientRect();
      const pos = (e.touches[0].clientX - rect.left) / rect.width;
      audio.currentTime = pos * audio.duration;
      e.preventDefault();
    };

    // Handle song end
    audio.onended = () => {
      playPauseBtn.innerHTML = '&#x23f5;';
      playPauseBtn.setAttribute('aria-label', 'Play');
    };
  }

  function showAlbum(albumType) {
    document.querySelector('.album-selection').style.display = 'none';
    document.getElementById('album-alternate').style.display = (albumType === 'alternate') ? 'block' : 'none';
    document.getElementById('album-original').style.display = (albumType === 'original') ? 'block' : 'none';
    // Hide mobile welcome text when showing album
    document.getElementById('mobile-welcome').style.display = 'none';
    // Close sidebar
    const sidebar = document.querySelector('.sidebar');
    sidebar.classList.remove('active');
  }

  function showSettings() {
    document.querySelector('.album-selection').style.display = 'none';
    document.getElementById('album-alternate').style.display = 'none';
    document.getElementById('album-original').style.display = 'none';
    document.getElementById('settings-view').style.display = 'block';
    // Hide mobile welcome text in settings
    document.getElementById('mobile-welcome').style.display = 'none';
    // Close sidebar
    const sidebar = document.querySelector('.sidebar');
    sidebar.classList.remove('active');
  }

  function backToSelection() {
    document.querySelector('.album-selection').style.display = 'flex';
    document.getElementById('album-alternate').style.display = 'none';
    document.getElementById('album-original').style.display = 'none';
    document.getElementById('settings-view').style.display = 'none';
    // Show mobile welcome text only on home page
    if (window.innerWidth <= 768) {
        document.getElementById('mobile-welcome').style.display = 'block';
    }
    // Close sidebar
    const sidebar = document.querySelector('.sidebar');
    sidebar.classList.remove('active');
  }

  function toggleSidebar() {
    const sidebar = document.querySelector('.sidebar');
    if (window.innerWidth <= 768) {
      sidebar.classList.toggle('active');
    }
  }

  // Close sidebar when clicking outside
  document.addEventListener('click', function(event) {
    const sidebar = document.querySelector('.sidebar');
    const hamburger = document.querySelector('.hamburger-menu');
    if (sidebar.classList.contains('active') && 
        !sidebar.contains(event.target) && 
        !hamburger.contains(event.target)) {
      sidebar.classList.remove('active');
    }
  });

  // Close sidebar when clicking a menu item
  document.querySelectorAll('.sidebar button').forEach(button => {
    button.addEventListener('click', () => {
      if (window.innerWidth <= 768) {
        toggleSidebar();
      }
    });
  });

  function updateWelcomeText() {
    const currentUser = localStorage.getItem('bpsb-current');
    const sidebarWelcome = document.getElementById('sidebar-welcome');
    const mobileWelcome = document.getElementById('mobile-welcome');
    
    if (window.innerWidth <= 768) {
        // Only show mobile welcome on home page
        const isHomePage = document.querySelector('.album-selection').style.display !== 'none';
        mobileWelcome.style.display = isHomePage ? 'block' : 'none';
        sidebarWelcome.textContent = 'Menu';
    } else {
        mobileWelcome.style.display = 'none';
        if (currentUser) {
            const hour = new Date().getHours();
            let greeting = "Welcome";
            if (hour >= 5 && hour < 12) {
                greeting = "Good morning";
            } else if (hour >= 12 && hour < 17) {
                greeting = "Good afternoon";
            } else {
                greeting = "Good evening";
            }
            sidebarWelcome.textContent = `${greeting}, ${currentUser}`;
        } else {
            sidebarWelcome.textContent = 'Menu';
        }
    }
  }

  window.addEventListener('DOMContentLoaded', () => {
    // Check login status first
    const currentUser = localStorage.getItem('bpsb-current');
    const sidebarWelcome = document.getElementById('sidebar-welcome');
    const mobileWelcome = document.getElementById('mobile-welcome');
    
    if (currentUser) {
      document.getElementById('login-modal').style.display = 'none';
      const hour = new Date().getHours();
      let greeting = "Welcome";
      if (hour >= 5 && hour < 12) {
        greeting = "Good morning";
      } else if (hour >= 12 && hour < 17) {
        greeting = "Good afternoon";
      } else {
        greeting = "Good evening";
      }
      if (window.innerWidth <= 768) {
        mobileWelcome.style.display = 'block';
        mobileWelcome.textContent = `${greeting}, ${currentUser}`;
        sidebarWelcome.textContent = 'Menu';
      } else {
        sidebarWelcome.textContent = `${greeting}, ${currentUser}`;
      }
    } else {
      sidebarWelcome.textContent = 'benpstokerbeats Streaming';
      mobileWelcome.style.display = 'none';
      document.getElementById('login-modal').style.display = 'flex';
    }

    // Load saved theme
    const savedTheme = localStorage.getItem('bpsb-theme') || 'system';
    setTheme(savedTheme);
    document.getElementById('theme-select-settings').value = savedTheme;

    // Load saved language
    const savedLanguage = localStorage.getItem('bpsb-language') || 'en';
    document.getElementById('language-select').value = savedLanguage;

    // Set up initial audio controls
    const audio = document.getElementById('now-playing-audio');
    const playPauseBtn = document.getElementById('play-pause-btn');
    const progressBar = document.getElementById('progress-bar');
    const progressFill = document.getElementById('progress-fill');
    const timeCurrent = document.getElementById('time-current');
    const timeDuration = document.getElementById('time-duration');

    if (playPauseBtn) {
      playPauseBtn.disabled = true;
      playPauseBtn.classList.add('disabled-btn');
    }

    if (audio) {
      setupAudioEventListeners(audio, playPauseBtn, progressBar, progressFill, timeCurrent, timeDuration);
    }

    // Add resize listener for welcome text
    window.addEventListener('resize', () => {
      const currentUser = localStorage.getItem('bpsb-current');
      updateAllWelcomeText(currentUser);
    });

    // Show mobile welcome text only if we're on the home page
    if (window.innerWidth <= 768) {
        const isHomePage = document.querySelector('.album-selection').style.display !== 'none';
        document.getElementById('mobile-welcome').style.display = isHomePage ? 'block' : 'none';
    }
  });
</script>
<body>

<div id="login-modal">
  <div class="welcome-section">
    <h1>Welcome to benpstokerbeats Streaming</h1>
    <p>Your personal music streaming experience. Sign in or create an account to get started.</p>
  </div>
  <div class="form-section">
    <h2 id="login-title">Sign Up for benpstokerbeats Streaming</h2>
    <input id="login-username" type="text" placeholder="Username" style="width:100%;padding:10px;margin-top:10px;margin-bottom:10px;border-radius:8px;border:1px solid #ccc;">
    <input id="login-email" type="email" placeholder="Email" style="width:100%;padding:10px;margin-bottom:10px;border-radius:8px;border:1px solid #ccc;">
    <input id="login-password" type="password" placeholder="Password" style="width:100%;padding:10px;margin-bottom:20px;border-radius:8px;border:1px solid #ccc;">
    <button onclick="submitForm()" style="width:100%;">Sign Up</button>
    <p style="text-align:center; margin-top:10px;">
      Already have an account? <a href="#" onclick="toggleLoginSignup()">Sign In</a>
    </p>
  </div>
</div>

<div class="hamburger-menu" onclick="toggleSidebar()">&#9776;</div>

<div class="sidebar">
  <div class="menu-header">
    <div class="close-menu" onclick="toggleSidebar()">&#x2715;</div>
  </div>
  <div>
    <h1 id="sidebar-welcome">benpstokerbeats Streaming</h1>
    <button onclick="backToSelection()" style="margin-top:20px;width:100%;">Home</button>
    <button onclick="showSettings()" style="margin-top:20px;width:100%;">Settings</button>
    <button onclick="logout()" style="margin-top:20px;width:100%;">Logout</button>
  </div>
</div>

<div class="main-content">
  <h1 id="mobile-welcome" style="display: none; text-align: center; width: 100%;">benpstokerbeats Streaming</h1>
  <div class="album-selection">
    <div class="album-option" onclick="showAlbum('alternate')">
      <img src="assets/rainy day album cover deluxe.png" alt="Alternate Skies" class="album-cover">
      <h2>Rainy Day Rainbow: Alternate Skies</h2>
      <p>benpstokerbeats</p>
    </div>
    <div class="album-option" onclick="showAlbum('original')">
      <img src="assets/rainy day rainbow album cover.jpeg" alt="Rainy Day Rainbow" class="album-cover">
      <h2>Rainy Day Rainbow</h2>
      <p>benpstokerbeats</p>
    </div>
  </div>

  <div id="settings-view" class="settings-view" style="display:none;">
    <h2>Settings</h2>
    <div class="settings-section">
      <h3>Appearance</h3>
      <div class="theme-select-settings">
        <label for="theme-select-settings">Theme</label>
        <select id="theme-select-settings" onchange="setTheme(this.value)">
          <option value="system">System</option>
          <option value="light">Light</option>
          <option value="dark">Dark</option>
          <option value="ocean">Ocean</option>
          <option value="sunset">Sunset</option>
          <option value="emerald">Emerald</option>
        </select>
      </div>
    </div>
    <div class="settings-section">
      <h3>General</h3>
      <div class="language-select-settings">
        <label for="language-select">Language (not currently working)</label>
        <select id="language-select" onchange="setLanguage(this.value)">
          <option value="en">English</option>
          <option value="es">Español</option>
          <option value="fr">Français</option>
          <option value="de">Deutsch</option>
          <option value="it">Italiano</option>
          <option value="pt">Português</option>
        </select>
      </div>
    </div>
  </div>

  <div id="album-alternate" class="album-view" style="display:none;">
    <img src="assets/rainy day album cover deluxe.png" alt="Rainy Day Rainbow: Alternate Skies" class="album-cover">
    <h2>Rainy Day Rainbow: Alternate Skies</h2>
    <p style="margin-bottom: 25px;">benpstokerbeats</p>
    <div class="track-row">
      <div class="track-info">
        <span>1. Rainy Day Rainbow</span> <span class="lossless">(Lossless)</span>
      </div>
      <button onclick="playNow('Rainy Day Rainbow', 'assets/Rainy Day Rainbow.wav')">&#x23f5;</button>
    </div>
    <div class="track-row">
      <div class="track-info">
        <span>2. Cool Summer Nights</span> <span class="lossless">(Lossless)</span>
      </div>
      <button onclick="playNow('Cool Summer Nights', 'assets/Cool Summer Nights.wav')">&#x23f5;</button>
    </div>
    <div class="track-row">
      <div class="track-info">
        <span>3. Sunny City Day</span> <span class="lossless">(Lossless)</span>
      </div>
      <button onclick="playNow('Sunny City Day', 'assets/Sunny City Day.wav')">&#x23f5;</button>
    </div>
    <div class="track-row">
      <div class="track-info">
        <span>4. Rainy Day Rainbow (Slowed)</span> <span class="lossless">(Lossless)</span>
      </div>
      <button onclick="playNow('Rainy Day Rainbow (Slowed)', 'assets/Rainy Day Rainbow (Slowed).wav')">&#x23f5;</button>
    </div>
    <div class="track-row">
      <div class="track-info">
        <span>5. Rainy Day Rainbow (Original Version)</span> <span class="lossless">(Lossless)</span>
      </div>
      <button onclick="playNow('Rainy Day Rainbow (Original Version)', 'assets/Rainy Day Rainbow (Original Version).wav')">&#x23f5;</button>
    </div>
    <div class="track-row">
      <div class="track-info">
        <span>6. Cool Summer Nights (Original Version)</span> <span class="lossless">(Lossless)</span>
      </div>
      <button onclick="playNow('Cool Summer Nights (Original Version)', 'assets/Cool Summer Nights (Original Version).wav')">&#x23f5;</button>
    </div>
    <div class="track-row">
      <div class="track-info">
        <span>7. Sunny City Ambience</span> <span class="lossless">(Lossless)</span>
      </div>
      <button onclick="playNow('Sunny City Ambience', 'assets/Sunny City Ambience.wav')">&#x23f5;</button>
    </div>
    <p style="margin-top:30px; font-size: 0.9em; color: var(--footer-color);">Released December 25, 2024<br/>℗ 2024 Stometheus Records</p>
    <p style="margin-top:30px; font-size: 0.9em; color: var(--footer-color);"></p>
    <div style="height: 30px;"></div>
  </div>

  <div id="album-original" class="album-view" style="display:none;">
    <img src="assets/rainy day rainbow album cover.jpeg" alt="Rainy Day Rainbow Album Cover" class="album-cover">
    <h2>Rainy Day Rainbow</h2>
    <p style="margin-bottom: 25px;">benpstokerbeats</p>
    <div class="track-row">
      <div class="track-info">
        <span>1. Rainy Day Rainbow</span> <span class="lossless">(Lossless)</span>
      </div>
      <button onclick="playNow('Rainy Day Rainbow', 'assets/Rainy Day Rainbow.wav')">&#x23f5;</button>
    </div>
    <div class="track-row">
      <div class="track-info">
        <span>2. Cool Summer Nights</span> <span class="lossless">(Lossless)</span>
      </div>
      <button onclick="playNow('Cool Summer Nights', 'assets/Cool Summer Nights.wav')">&#x23f5;</button>
    </div>
    <div class="track-row">
      <div class="track-info">
        <span>3. Sunny City Day</span> <span class="lossless">(Lossless)</span>
      </div>
      <button onclick="playNow('Sunny City Day', 'assets/Sunny City Day.wav')">&#x23f5;</button>
    </div>
    <p style="margin-top:30px; font-size: 0.9em; color: var(--footer-color);">Released September 25, 2023<br/>℗ 2023 Stometheus Records</p>
    <p style="margin-top:30px; font-size: 0.9em; color: var(--footer-color);"></p>
    <div style="height: 30px;"></div>
  </div>
</div>

<div class="now-playing" id="now-playing">
  <div class="track-name" id="current-track">
    <span class="track-name-text" style="animation: none;">Not Playing</span>
  </div>
  <div class="now-playing-controls">
    <button id="play-pause-btn" class="play-pause-btn" aria-label="Play/Pause">&#x23f5;</button>
    <div class="progress-container" aria-label="Audio progress">
      <div class="time-current" id="time-current">--:--</div>
      <div class="progress-bar" id="progress-bar" tabindex="0" role="slider" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
        <div class="progress-fill" id="progress-fill"></div>
      </div>
      <div class="time-duration" id="time-duration">--:--</div>
    </div>
    <label style="font-size:0.9em; margin-bottom: 0; display: flex; align-items: center; gap: 5px;">Volume
      <input type="range" id="audio-volume" min="0" max="1" step="0.01" value="1" style="vertical-align:middle;">
    </label>
  </div>
  <audio id="now-playing-audio" style="display:none;"></audio>
</div>

</body>
</html>
